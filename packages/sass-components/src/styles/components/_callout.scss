// Callout 组件样式
// 为 CalloutProcessor.ts 导出的 callout 块提供样式支持

@use "../base/variables" as *;
@use "sass:map";

// Mixin: 生成 callout 样式（简化重复代码）
@mixin callout-style($color, $svg-template) {
  border-left-color: $color;
  background-color: rgba($color, $callout-background-opacity);
  
  .callout-title {
    color: $color;
    
    &::before {
      background-image: url(#{colored-svg($svg-template, $color)});
    }
  }
}

// 基础 callout 样式
.callout {
  margin: $callout-margin;
  padding: $callout-padding;
  border-left: $callout-border-width solid;
  border-radius: $callout-border-radius;
  font-family: $callout-font-family;
  font-size: $callout-font-size;
  line-height: $callout-line-height;
  
  // 默认样式（info 类型）
  $default-color: map-get(map-get($callout-groups, "info"), color);
  @include callout-style($default-color, map-get($callout-svg-templates, "info"));
  
  // callout 标题样式
  .callout-title {
    font-weight: $callout-title-font-weight;
    margin-top: $callout-title-margin-top;
    margin-bottom: $callout-title-margin-bottom;
    display: flex;
    align-items: center;
    
    // 默认图标样式
    &::before {
      content: "";
      width: $callout-icon-size;
      height: $callout-icon-size;
      margin-right: $callout-icon-margin-right;
      flex-shrink: 0;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      display: inline-block;
    }
  }
  
  // callout 内容样式
  .callout-content {
    color: inherit;
    
    // 移除最后一个元素的下边距
    > *:last-child {
      margin-bottom: 0;
    }
  }
  
  // 生成所有 callout 类型样式（简洁的分组方式）
  @each $group-name, $group-config in $callout-groups {
    $color: map-get($group-config, color);
    $types: map-get($group-config, types);
    
    // 为该组的所有类型生成样式
    @each $type in $types {
      &[callout-type="#{$type}"] {
        @include callout-style($color, map-get($callout-svg-templates, $type));
      }
    }
  }

  
  // 折叠功能支持（使用 details 元素）
  &[open] {
    summary.callout-title::after {
      transform: rotate(90deg);
    }
  }
  
  &:not([open]) {
    summary.callout-title::after {
      transform: rotate(0deg);
    }
  }
  
  .callout-title p {
    display: inline;
    white-space: nowrap;
    margin: 0;
    padding: 0;
  }

  // 当 callout-title 作为 summary 时的可折叠样式
  summary.callout-title {
    cursor: pointer;
    user-select: none;
    
    // 使用 ::after 生成折叠指示器
    &::after {
      content: "";
      background-color: currentColor;
      mask-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0ibTkgMThsNi02bC02LTYiLz48L3N2Zz4=");
      mask-size: 100%;
      -webkit-mask-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxwYXRoIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0ibTkgMThsNi02bC02LTYiLz48L3N2Zz4=");
      -webkit-mask-size: 100%;
      height: 18px;
      width: 18px;
      transition: transform 200ms ease-in-out;
      flex-shrink: 0;
      margin-left: auto;
    }
  }
}
